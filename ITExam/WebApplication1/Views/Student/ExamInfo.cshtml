@using ITExam.ViewModels.Exam
@model ExamVM 
 <!DOCTYPE html> 
 <html lang="vi"> 

 <head> 
     <meta charset="UTF-8"> 
     <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
     <title>Thông tin đề thi</title> 
     <!-- Bootstrap CSS v5.2.1 --> 
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" 
     integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" /> 
     <!-- FontAwesome 6.2.0 CSS --> 
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" 
     integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" 
     crossorigin="anonymous" referrerpolicy="no-referrer" /> 
     <!-- Font Google --> 
     <link rel="preconnect" href="https://fonts.googleapis.com"> 
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
     <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Paytone+One&display=swap" 
     rel="stylesheet"> 
     <!-- Css -->
    <link rel="stylesheet" href="~/css/style.css">
    <link rel="stylesheet" href="~/css/info-exam-style.css"> 
 </head> 

 <body> 
     <header class="sticky-top">
        <div class="container-fluid p-0">
            <nav class="navbar navbar-expand-lg bg-white navbar-light py-3 py-lg-0 px-lg-5 d-flex justify-content-between">
                <a href="#" class="navbar-brand ml-lg-3">
                    <h1 class="m-0 text-uppercase text-primary">ITEXAM</h1>
                </a>
                <div class="px-lg-3" id="navbarCollapse">
                    <div class="btn-back">
                        <a asp-controller="Student" asp-action="ClassDetail" asp-route-id="@Model.ClassId" style="cursor: pointer; text-decoration: none ;">
                            <i class="fa-solid fa-circle-left fa-xl"></i> Quay lại
                        </a>
                    </div>
                </div>
            </nav>
        </div>
     </header> 
     <main> 
         <div class="m-3">
            <!-- Contact Start -->
            <div class="container-fluid py-2">
                <div class="container py-2">
                    <div class="row align-items-center">
                        <div class="col-lg-5 mb-4 mb-lg-0">
                            <div class="bg-light d-flex flex-column justify-content-center px-3" style="height: 400px;">
                                <div class="d-flex align-items-center mb-5">
                                    <div class="btn-icon bg-primary mr-4">
                                    </div>
                                    <div class="mt-n1">
                                        <h4>Loại đề</h4>
                                        <p class="h5 fw-bold m-0">@Model.ExamType</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center mb-5">
                                    <div class="btn-icon bg-secondary mr-4">
                                    </div>
                                    <div class="mt-n1">
                                        <h4>Số lượng câu hỏi</h4>
                                        <p class="h5 fw-bold m-0">@Model.QuestionCount</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="btn-icon bg-warning mr-4">
                                    </div>
                                    <div class="mt-n1">
                                        <h4>Thời gian</h4>
                                        <p class="h5 fw-bold m-0">@Model.Duration phút</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-7">
                            <div class="section-title position-relative mb-2">
                                <h6 class="d-inline-block position-relative text-secondary text-uppercase pb-2">Thông tin đề thi</h6>
                                <h1 class="display-4">@Model.ExamName</h1>
                            </div>
                            <br />

                            <div class="contact-form">
                                <div class="form-group">
                                    <input type="text" class="form-control border-top-0 border-right-0 border-left-0 p-0" required="required" value=" Giảng viên: @Model.FullName" readonly>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control border-top-0 border-right-0 border-left-0 p-0" required="required" value=" Ngày tạo: @Model.CreatedDate.ToString("dd/MM/yyyy")" readonly>
                                </div>
                                <div>
                                    <button class="btn btn-primary py-3 px-5" data-bs-toggle="modal"
                                            data-bs-target="#staticBackdrop-take-the-exam">
                                        Vào thi ngay
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Contact End -->
         </div> 
     </main> 

     <div class="modal fade" 
     id="staticBackdrop-take-the-exam" 
     data-bs-backdrop="static" 
     data-bs-keyboard="false" 
     tabindex="-1" 
     aria-labelledby="staticBackdropLabel" 
     aria-hidden="true"> 
         <div class="modal-dialog modal-dialog-centered modal-lg rounded"> 
             <div class="modal-content border-0 shadow"> 
                 <div class="modal-header bg-primary text-white"> 
                     <h5 class="modal-title fw-bold text-white" id="staticBackdropLabel"> 
                         Xác nhận vào thi 
                     </h5> 
                     <button type="button" 
                     class="btn-close btn-close-white" 
                     data-bs-dismiss="modal" 
                     aria-label="Close"></button> 
                 </div> 
                 <div class="modal-body bg-light"> 
                     <div class="px-2"> 
                         <h5 class="text-danger fw-bold mb-3"> 
                             <i class="fa-solid fa-circle-info fa-shake me-2"></i>Lưu ý: 
                         </h5> 
                         <ol class="list-group list-group-numbered"> 
                             <li class="list-group-item"> 
                                 Đảm bảo kết nối mạng ổn định trong suốt quá trình thi. 
                             </li> 
                             <li class="list-group-item"> 
                                 Không mở thêm các cửa sổ hoặc tab trình duyệt khác trong khi làm bài. 
                             </li> 
                             <li class="list-group-item"> 
                                 Không chụp màn hình bài thi hay sử dụng công cụ hỗ trợ gian lận. 
                             </li> 
                             <li class="list-group-item"> 
                                 Đọc kỹ từng câu hỏi và kiểm tra lại đáp án trước khi nộp bài. 
                             </li> 
                             <li class="list-group-item"> 
                                 Sau khi nộp bài, bạn sẽ không thể thay đổi bất kỳ câu trả lời nào. 
                             </li> 
                         </ol> 
                         <div class="alert alert-danger d-flex align-items-center" role="alert"> 
                             <i class="fa-solid fa-triangle-exclamation fa-2x me-3"></i> 
                             <div> 
                                 <strong class="fs-5">HỆ THỐNG SẼ TỰ ĐỘNG NỘP BÀI</strong> 
                                 <span class="d-block mt-1">nếu phát hiện bất kỳ hình thức gian lận nào!</span> 
                             </div> 
                         </div> 

                         <p class="mt-4 mb-0"> 
                             Nhấn nút "<strong>Vào thi</strong>" để bắt đầu làm bài ngay sau khi đã đọc kỹ những lưu ý trên. 
                         </p> 
                     </div> 
                 </div> 
                 <div class="modal-footer bg-white border-0"> 
                     <button type="button" 
                     class="btn btn-secondary" 
                     data-bs-dismiss="modal"> 
                         Đóng 
                     </button> 
                     @if(Model.ExamType == "Trắc nghiệm") 
                     {
                        <form id="examForm" asp-controller="Student" asp-action="TakeTheExam_TN" method="post">
                            <input type="hidden" name="maDe" value="@Model.ExamId" />
                            <input type="hidden" name="maLop" value="@Model.ClassId" />
                            <button type="submit" class="btn btn-primary fw-bold"><i class="fa-solid fa-play me-1"></i> Vào thi</button>
                        </form>
                     } 
                     else 
                     {

                        <form id="examForm" asp-controller="Student" asp-action="TakeTheExam_TL" method="post">
                            <input type="hidden" name="maDe" value="@Model.ExamId" />
                            <input type="hidden" name="maLop" value="@Model.ClassId" />
                            <button type="submit" class="btn btn-primary fw-bold"><i class="fa-solid fa-play me-1"></i> Vào thi</button>
                        </form>
                     } 
                 </div> 
             </div> 
         </div> 
     </div> 


     <!-- Bootstrap JavaScript Libraries --> 
     <script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.11.6/dist/umd/popper.min.js" 
             integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" 
             crossorigin="anonymous"></script> 
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" 
             integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" 
             crossorigin="anonymous"></script>
    <script>
        document.getElementById('examForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Ngăn form gửi theo cách truyền thống

            // Lấy URL action form (có thể build bằng JS nếu cần)
            const form = event.target;
            const url = form.action;

            // Tạo form data
            const formData = new FormData(form);

            // Mở tab mới và gửi dữ liệu qua POST
            const newWindow = window.open('', '_blank');

            // Tạo form gửi trong tab mới để POST dữ liệu (do window.open không hỗ trợ POST trực tiếp)
            const formHtml = `
                <form id="newForm" method="post" action="${url}">
                    ${[...formData.entries()].map(([k,v]) => `<input type="hidden" name="${k}" value="${v}">`).join('')}
                </form>
                <script>document.getElementById('newForm').submit();<\/script>
            `;

            newWindow.document.write(formHtml);
            newWindow.document.close();

            // Đóng tab hiện tại (nếu trình duyệt cho phép)
            window.close();
        });
    </script>
 </body> 
 </html>